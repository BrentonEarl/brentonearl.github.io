<!DOCTYPE HTML>
<!-- Microdata markup added by Google Structured Data Markup Helper. -->
<html lang="en">
	<head>       
		<meta charset=utf-8>
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
		<title>Exit Status One - Cucumber, Capybara and Sinatra</title>
		<meta name="author" content="Brenton Earl" />
		
		<meta name="description" content="Basic usage of Cucumber and Capybara.  Explaining how it will simplify your software development process in web applications." />
		
		
		<meta name="keywords" content="sinatra" />
		
		<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
		<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap-theme.min.css">
		<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
		<!--[if lt IE 9]>
		<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
		<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
		<![endif]-->
		<!-- -->
		<!-- Google Analytics Tracking -->
		<script> 
			(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
			 (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new
			 Date();a=s.createElement(o),
			 m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
			 })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

			ga('create', 'UA-42531432-1', 'auto');
			ga('send', 'pageview');

		</script>
	</head>
	<body>
		<nav class="navbar navbar-inverse navbar-static-top" role="navigation">
			<div class="container">
				<div class="navbar-header">
					<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
						<span class="sr-only">Toggle navigation</span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</button>
					<p class="navbar-brand" href="#">Menu</p>
				</div>
				<div class="navbar-collapse collapse">
					<ul class="nav navbar-nav">
						<li><a href="/" title=" Index">Home</a></li>
						
						
						
						<li><a href="/about.html" title="About the Author">About</a></li>
						
						
						
						<li><a href="/archive.html" title="Site Archives">Archives</a></li>
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						<li><a href="/rss.xml" title="RSS News Feed">News Feed</a></li>
						
						
					</ul>
				</div>
			</div>
		</nav>
		<header>
			<div class="container">
				<div class="page-header">
					<h1>Exit Status One</h1>
					<small>~# while : ; do echo 'Tinker, explore, hack, learn...' ; sleep 28800 ; clear ; done</small>
				</div>
			</div>
		</header>
	
		<div class="container">
					<div class="row">
				<div class="col-sm-8">
					<article itemscope itemtype="http://schema.org/Article">
						<h4 itemprop="name">Cucumber, Capybara and Sinatra</h4>
						<p>
							<span itemprop="datePublished" content="08-04-2013">							
								08-04-2013
							</span>
							 by 
							<a href="https://plus.google.com/+Exitstatusone" rel="publisher">
								<span itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
									<span itemprop="name">Brenton Earl</span>
								</span>
							</a>
						</p>
						

						<p>
						Category <a href="/categories/sinatra/">sinatra</a>
						</p>
						<span itemprop="articleBody">
							<p>Simply put, <a href="http://en.wikipedia.org/wiki/Behavior-driven_development">Behaviour Driven Development</a> is the process of building a software from the Outside - In while providing software testing and basic documentation.  Creating a web application, or any program for that matter, from the outside-in, simplifies the process of developing software.  The process of software development always starts with communication between a consumer and a software developer to formulate a model.  Typically programmers have to find a way to describe technial programming jargon to consumers in order to explain how a piece of software will be developed.</p>

<p>Using Behaviour Driven Development bridges that gap by allowing the programmer and the consumer to sit down together and write a story.  A story about how both parties wish to express what their software will do and how it will do it.  In the BDD story, consumers have every say in how their software will be built.  In addition, programmers can then convert this story into actual programming code.  Furthermore, the story can be used to do software testing prior to writing a single piece of code. Essentially, BDD bridges the gap between programmers and non-programmers, allowing for fast-paced software development, while everyone involved knows exactly what the result will be for the final product.</p>

<p>For this article I will be refering to my previous article discussing a <a href="http://exitstatusone.com/sinatra-simple-blog/">Basic Sinatra Blog</a>.  I will show you how to use two tools: Cucumber and Capybara.  With these two tools, I will be able to test the back end code as well as the front end of my web application.</p>

<p><em>Please note, in order to follow along, you will need ruby 1.9+, rubygems and the ability to install Capybara and Cucumber.</em></p>

<ul>
<li><a href="http://jnicklas.github.io/capybara/">Installation instructions for Capybara</a>  (scroll down the page a little)</li>
<li><a href="https://github.com/cucumber/cucumber/wiki/Install">Installation instructions for Cucumber</a></li>
</ul>


<h4>Capybara</h4>

<p>Before I delve into the development process, let me introduce <a href="http://jnicklas.github.io/capybara/">Capybara</a>.  Capybara is a library written in Ruby that allows you to simulate how your web application front end interacts with a user.  With this tool you will be able to run your software testing without ever having opened a web browser.  It will save you a lot of time while building your application, and later on you can do manual testing to assure your site interacts according to your automated tests.</p>

<p>Please see the <a href="http://rubydoc.info/github/jnicklas/capybara/master">Capybara RDoc</a> for information regarding usage, syntax and how Capybara can be applied. Later in the article I will have a few examples of how I used Capybara to automate the testing of my web application.</p>

<h4>Cucumber</h4>

<p><a href="http://cukes.info/">Cucumber</a>: "Cucubmer, behaviour driven development with elegance and joy."</p>

<p>When I first read about Cucumber, I realized how effective this tool would be almost immediately.  When beginning to use Cucumber, it takes a bit of getting used to.  Seeing as I have never really taken on a large software development project, I can only guess that acclimating to a tool like Cucumber could be awkward at first.  Once you take an in-depth look at Cucumber, you will understand the benefits this form of software development offers.</p>

<hr />

<h4>The Beginning</h4>

<p>The Cucumber story of my software begins by describing a Feature which is followed by Scenario cases where the Feature is applied.  Following my previous article regarding a <a href="http://exitstatusone.com/sinatra-simple-blog/">Basic Sinatra Blog</a>, I will show how I created the Feature I used to decide how I would display articles within the web application.</p>

<h4>The Feature</h4>

<p>The following is the Feature I added:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="ss">Feature</span><span class="p">:</span> <span class="no">View</span> <span class="no">Articles</span>
      <span class="no">In</span> <span class="n">order</span> <span class="n">to</span> <span class="n">view</span> <span class="n">articles</span>
      <span class="no">As</span> <span class="n">a</span> <span class="n">user</span>
      <span class="n">I</span> <span class="n">must</span> <span class="n">visit</span> <span class="n">the</span> <span class="n">home</span> <span class="n">page</span>
      <span class="no">And</span> <span class="n">click</span> <span class="n">a</span> <span class="n">link</span> <span class="n">to</span> <span class="n">view</span> <span class="n">an</span> <span class="n">aritlce</span>
      <span class="no">Then</span> <span class="n">the</span> <span class="n">article</span> <span class="n">will</span> <span class="n">be</span> <span class="n">displayed</span></code></pre></div>


<p>The feature block is the most important portion of the story.  It describes the Feature you are going to implement in entirety.  It is important to keep it short and to the point in order to clearly express what you intend to do.  A description any longer than a few lines probably means you need to split your feature up into separate features.</p>

<h4>The Background</h4>

<p>The Background is a block that sets the background of the feature. (Obviously) In my case this backround assures that each scenario has a news aritlce in the database to test against.  Backgrounds are not required, but in my case, I plan to add many many more scenarios in the future to test how and where News Articles are viewed throughout the blog. The Background allows reference to a created Article without having to repeat myself while developing the web application.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="ss">Background</span><span class="p">:</span>  <span class="no">Create</span> <span class="n">news</span> <span class="n">article</span>
    <span class="no">Given</span> <span class="n">I</span> <span class="n">create</span> <span class="n">a</span> <span class="n">news</span> <span class="n">article</span> <span class="n">named</span> <span class="s2">&quot;Hello World&quot;</span>
    <span class="no">Then</span> <span class="n">I</span> <span class="n">should</span> <span class="n">be</span> <span class="n">able</span> <span class="n">to</span> <span class="n">find</span> <span class="n">the</span> <span class="n">article</span> <span class="s2">&quot;Hello World&quot;</span></code></pre></div>


<p>Essentially, I create the article and do a quick query against the database to assure the inserted article did in fact get saved to the database.</p>

<h4>The Scenario</h4>

<p>A scenario is a small part of how you intend to fully implement the feature.  In your scenarios, it is a good idea to keep your written text as flowing as possible.</p>

<p>For example, I decided that I wanted to start on the Home Page.  Yes, in second scenario I repeat myself on the first line to state I am on the "/" (Root or Home Page) of my application.  By doing so I save myself the hastle of having to write more programing code to express that I am on the home page.  This is important to think about when you begin to write your step definitions.  <em>More on step definitions later in this post.</em></p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="ss">Scenario</span><span class="p">:</span>  <span class="no">Display</span> <span class="n">the</span> <span class="n">last</span> <span class="mi">10</span> <span class="n">news</span> <span class="n">articles</span> <span class="n">on</span> <span class="n">home</span> <span class="n">page</span>
    <span class="no">Given</span> <span class="n">I</span> <span class="n">am</span> <span class="n">on</span> <span class="n">the</span> <span class="n">site</span> <span class="n">page</span> <span class="s2">&quot;/&quot;</span> 
    <span class="no">Then</span> <span class="n">I</span> <span class="n">should</span> <span class="n">be</span> <span class="n">able</span> <span class="n">to</span> <span class="n">see</span> <span class="s2">&quot;Recent Posts&quot;</span>
    <span class="no">And</span> <span class="n">the</span> <span class="n">first</span> <span class="n">article</span> <span class="n">named</span> <span class="s2">&quot;Hello World&quot;</span></code></pre></div>


<p>I think this block speaks for itself.  However the second line (Then ...) describes that I will see a heading on the Home page named "Recent Posts".  The third states I will see another heading named "Hello World" which is the name of the news article I inserted in the Background block above.  This allows the code to establish where to begin evaluating the Feature.  As I continue to write my Scenarios, I am adding more and more to the story of how I want my application to function.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="ss">Scenario</span><span class="p">:</span> <span class="no">Click</span> <span class="n">the</span> <span class="n">link</span> <span class="n">to</span> <span class="n">go</span> <span class="n">to</span> <span class="n">view</span> <span class="n">an</span> <span class="n">article</span>
    <span class="no">Given</span> <span class="n">I</span> <span class="n">am</span> <span class="n">on</span> <span class="n">the</span> <span class="n">site</span> <span class="n">page</span> <span class="s2">&quot;/&quot;</span> 
    <span class="no">Then</span> <span class="n">I</span> <span class="n">should</span> <span class="n">see</span> <span class="s2">&quot;View Article&quot;</span> <span class="k">in</span> <span class="n">a</span> <span class="n">link</span>
    <span class="no">And</span> <span class="n">I</span> <span class="n">should</span> <span class="n">click</span> <span class="n">the</span> <span class="n">link</span> <span class="s2">&quot;View Article&quot;</span>
    <span class="no">Then</span> <span class="n">I</span> <span class="n">should</span> <span class="n">see</span> <span class="s2">&quot;Hello World&quot;</span></code></pre></div>


<p>Again, this Scenario is self explanatory, maybe even more so than the previous.  See how the story is building on itself?  As I write more and more, notice how the story develops into a detailed representation of the Feature.  This is sort of like writting an essay in school! Gasp, not that again.</p>

<h4>Where, What, How?</h4>

<p>So I have my text file expressing the feature.  Where do I put the feature?  What do I name it? and How is it applied to the testing and the expanding of my code base?</p>

<p>I will tell you:</p>

<ol>
<li>I first create a folder where my project will be kept, called "exitstatusone."</li>
<li>Next I create the folder named "feature" within my project folder.</li>
<li>Within the "feature" folder I create two additional folders:  "support" and "step_definitions"</li>
<li>I then save the Feature in the feature folder, naming it "article.feature."</li>
</ol>


<p>Next I will need to configure my development environment to ask Capybara to test the front end of my web application (the web page in the web browser).  In the support folder I created for Cucumber, I will add a file called env.rb. In this file I will insert the following:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">require</span> <span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="no">File</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">__FILE__</span><span class="p">),</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;exitstatusone&#39;</span><span class="p">)</span>
<span class="nb">require</span> <span class="s1">&#39;capybara&#39;</span>
<span class="nb">require</span> <span class="s1">&#39;capybara/cucumber&#39;</span>

<span class="no">Capybara</span><span class="o">.</span><span class="n">app</span> <span class="o">=</span> <span class="no">ExitStatusOne</span></code></pre></div>


<ol>
<li>Where File.join points to the name of my application.  i.e exitstatusone is my project code named exitstatusone.rb within my project folder.</li>
<li>Capybara is loaded</li>
<li>Cucumber is loaded</li>
<li>Capybara.app equals the name of my application.</li>
</ol>


<h4>Is Everything Set Yet???</h4>

<p>Of course, it is all set.  Everything is in place to run Cucumber and have Capybara find each element on the page.  It is time to run Cucumber and begin developing the web application.</p>

<p><em>Remember, we are following the article <a href="http://exitstatusone.com/sinatra-simple-blog/">Basic Sinatra Blog</a>.  In that article I show a listing of my database model.  Refer to that in order to understand the code behind how I created the news article.  We wont go into detail on how Data Mapper works, that is for an entirely different article at a later time. =)</em></p>

<h4>Step Definitions</h4>

<p>Step Definitions are the code that helps Cucumber find and execute your code within your web application code.  Each feature will have a corresponding file located in the "step_definitions" folder.  In this example, my feature is called "articles.feature" and it is located within the "feature" folder.  In order to implement my step definition I will need to create ruby file that contains the output of Cucumber.  Let me execute Cucumber and check the output.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">alk3</span><span class="vi">@exitstatusone</span><span class="ss">:~</span><span class="sr">/Learn/</span><span class="no">Sinatra</span><span class="o">/</span><span class="no">Projects</span><span class="o">/</span><span class="n">tutorial</span><span class="err">$</span> <span class="n">cucumber</span>
<span class="ss">Feature</span><span class="p">:</span> <span class="no">View</span> <span class="no">Articles</span>
  <span class="no">In</span> <span class="n">order</span> <span class="n">to</span> <span class="n">view</span> <span class="n">articles</span>
  <span class="no">As</span> <span class="n">a</span> <span class="n">user</span>
  <span class="n">I</span> <span class="n">must</span> <span class="n">visit</span> <span class="n">the</span> <span class="n">home</span> <span class="n">page</span>
  <span class="no">And</span> <span class="n">click</span> <span class="n">a</span> <span class="n">link</span> <span class="n">to</span> <span class="n">view</span> <span class="n">an</span> <span class="n">aritcle</span>
  <span class="no">Then</span> <span class="n">it</span> <span class="n">will</span> <span class="n">be</span> <span class="n">displayed</span>

  <span class="ss">Background</span><span class="p">:</span> <span class="no">Create</span> <span class="n">news</span> <span class="n">article</span>                           <span class="c1"># features/articles.feature:8</span>
    <span class="no">Given</span> <span class="n">I</span> <span class="n">create</span> <span class="n">a</span> <span class="n">news</span> <span class="n">article</span> <span class="n">named</span> <span class="s2">&quot;Hello World&quot;</span>       <span class="c1"># features/articles.feature:9</span>
    <span class="no">Then</span> <span class="n">I</span> <span class="n">should</span> <span class="n">be</span> <span class="n">able</span> <span class="n">to</span> <span class="n">find</span> <span class="n">the</span> <span class="n">article</span> <span class="s2">&quot;Hello World&quot;</span> <span class="c1"># features/articles.feature:10</span>

<span class="mi">0</span> <span class="n">scenarios</span>
<span class="mi">2</span> <span class="n">steps</span> <span class="p">(</span><span class="mi">2</span> <span class="n">undefined</span><span class="p">)</span>
<span class="mi">0</span><span class="n">m0</span><span class="o">.</span><span class="mo">002</span><span class="n">s</span>

<span class="no">You</span> <span class="n">can</span> <span class="n">implement</span> <span class="n">step</span> <span class="n">definitions</span> <span class="k">for</span> <span class="n">undefined</span> <span class="n">steps</span> <span class="n">with</span> <span class="n">these</span> <span class="ss">snippets</span><span class="p">:</span>

<span class="no">Given</span><span class="p">(</span><span class="sr">/^I create a news article named &quot;(.*?)&quot;$/</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">arg1</span><span class="o">|</span>
  <span class="n">pending</span> <span class="c1"># express the regexp above with the code you wish you had</span>
<span class="k">end</span>

<span class="no">Then</span><span class="p">(</span><span class="sr">/^I should be able to find the article &quot;(.*?)&quot;$/</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">arg1</span><span class="o">|</span>
  <span class="n">pending</span> <span class="c1"># express the regexp above with the code you wish you had</span>
<span class="k">end</span></code></pre></div>


<p>This shows the output of the Feature, how long it took to run, how many steps there are and how to run the code.</p>

<p>I will now create my step definition.  I will name it articles.rb, put it in the "step_definitions" folder, and copy the suggested code snippets Cucumber gives me into that file.  I will then run Cucumber again.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">alk3</span><span class="vi">@exitstatusone</span><span class="ss">:~</span><span class="sr">/Learn/</span><span class="no">Sinatra</span><span class="o">/</span><span class="no">Projects</span><span class="o">/</span><span class="n">tutorial</span><span class="err">$</span> <span class="n">cucumber</span>
<span class="ss">Feature</span><span class="p">:</span> <span class="no">View</span> <span class="no">Articles</span>
  <span class="no">In</span> <span class="n">order</span> <span class="n">to</span> <span class="n">view</span> <span class="n">articles</span>
  <span class="no">As</span> <span class="n">a</span> <span class="n">user</span>
  <span class="n">I</span> <span class="n">must</span> <span class="n">visit</span> <span class="n">the</span> <span class="n">home</span> <span class="n">page</span>
  <span class="no">And</span> <span class="n">click</span> <span class="n">a</span> <span class="n">link</span> <span class="n">to</span> <span class="n">view</span> <span class="n">an</span> <span class="n">aritcle</span>
  <span class="no">Then</span> <span class="n">it</span> <span class="n">will</span> <span class="n">be</span> <span class="n">displayed</span>

  <span class="ss">Background</span><span class="p">:</span> <span class="no">Create</span> <span class="n">news</span> <span class="n">article</span>                           <span class="c1"># features/articles.feature:8</span>
    <span class="no">Given</span> <span class="n">I</span> <span class="n">create</span> <span class="n">a</span> <span class="n">news</span> <span class="n">article</span> <span class="n">named</span> <span class="s2">&quot;Hello World&quot;</span>       <span class="c1"># features/step_definitions/articles.rb:1</span>
      <span class="no">TODO</span> <span class="p">(</span><span class="no">Cucumber</span><span class="o">::</span><span class="no">Pending</span><span class="p">)</span>
      <span class="o">.</span><span class="n">/features</span><span class="o">/</span><span class="n">step_definitions</span><span class="o">/</span><span class="n">articles</span><span class="o">.</span><span class="n">rb</span><span class="p">:</span><span class="mi">2</span><span class="ss">:in</span> <span class="sb">`/^I create a news article named &quot;(.*?)&quot;$/&#39;</span>
<span class="sb">      features/articles.feature:9:in `</span><span class="no">Given</span> <span class="n">I</span> <span class="n">create</span> <span class="n">a</span> <span class="n">news</span> <span class="n">article</span> <span class="n">named</span> <span class="s2">&quot;Hello World&quot;</span><span class="err">&#39;</span>
    <span class="no">Then</span> <span class="n">I</span> <span class="n">should</span> <span class="n">be</span> <span class="n">able</span> <span class="n">to</span> <span class="n">find</span> <span class="n">the</span> <span class="n">article</span> <span class="s2">&quot;Hello World&quot;</span> <span class="c1"># features/step_definitions/articles.rb:5</span>

<span class="mi">0</span> <span class="n">scenarios</span>
<span class="mi">2</span> <span class="n">steps</span> <span class="p">(</span><span class="mi">1</span> <span class="n">skipped</span><span class="p">,</span> <span class="mi">1</span> <span class="n">pending</span><span class="p">)</span>
<span class="mi">0</span><span class="n">m0</span><span class="o">.</span><span class="mo">002</span><span class="n">s</span></code></pre></div>


<p>Sweet.  Now all I need to do is add the appropriate code to make my steps pass and to implement the first portion of my Feature.  I will add the following code into the articles.rb file located in the "step_definitions" folder.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">Given</span><span class="p">(</span><span class="sr">/^I create a news article named &quot;(.*?)&quot;$/</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">arg1</span><span class="o">|</span>
  <span class="n">body</span> <span class="o">=</span> <span class="s2">&quot;Welcome to my web site.  This is the first post.  Keep checking back.&quot;</span>
  <span class="n">article</span> <span class="o">=</span> <span class="no">Content</span><span class="o">.</span><span class="n">first_or_create</span><span class="p">(</span>
    <span class="ss">:title</span> <span class="o">=&gt;</span> <span class="n">arg1</span><span class="p">,</span>
    <span class="ss">:body</span> <span class="o">=&gt;</span> <span class="n">body</span><span class="p">,</span>
    <span class="ss">:permalink</span> <span class="o">=&gt;</span> <span class="s1">&#39;hello-world&#39;</span><span class="p">,</span>
    <span class="ss">:author</span> <span class="o">=&gt;</span> <span class="s1">&#39;Mr Alk3&#39;</span><span class="p">,</span>
    <span class="ss">:category</span> <span class="o">=&gt;</span> <span class="s1">&#39;News&#39;</span><span class="p">,</span>
    <span class="ss">:created_at</span> <span class="o">=&gt;</span> <span class="no">Time</span><span class="o">.</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%m-%d-%Y&quot;</span><span class="p">)</span>
    <span class="p">)</span>   
  <span class="n">article</span><span class="o">.</span><span class="n">save</span>
<span class="k">end</span>

<span class="no">Then</span><span class="p">(</span><span class="sr">/^I should be able to find the article &quot;(.*?)&quot;$/</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">arg1</span><span class="o">|</span>
  <span class="n">find</span> <span class="o">=</span> <span class="no">Content</span><span class="o">.</span><span class="n">first</span><span class="p">(</span><span class="ss">:title</span><span class="o">.</span><span class="n">like</span> <span class="o">=&gt;</span> <span class="s2">&quot;%</span><span class="si">#{</span><span class="n">arg1</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
<span class="k">end</span></code></pre></div>


<p>Great, let me run Cucumber and check the output.  Hopefull everything passes and we can move onto creating a Scenario.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">alk3</span><span class="vi">@exitstatusone</span><span class="ss">:~</span><span class="sr">/Learn/</span><span class="no">Sinatra</span><span class="o">/</span><span class="no">Projects</span><span class="o">/</span><span class="n">tutorial</span><span class="err">$</span> <span class="n">cucumber</span>
<span class="ss">Feature</span><span class="p">:</span> <span class="no">View</span> <span class="no">Articles</span>
  <span class="no">In</span> <span class="n">order</span> <span class="n">to</span> <span class="n">view</span> <span class="n">articles</span>
  <span class="no">As</span> <span class="n">a</span> <span class="n">user</span>
  <span class="n">I</span> <span class="n">must</span> <span class="n">visit</span> <span class="n">the</span> <span class="n">home</span> <span class="n">page</span>
  <span class="no">And</span> <span class="n">click</span> <span class="n">a</span> <span class="n">link</span> <span class="n">to</span> <span class="n">view</span> <span class="n">an</span> <span class="n">aritcle</span>
  <span class="no">Then</span> <span class="n">it</span> <span class="n">will</span> <span class="n">be</span> <span class="n">displayed</span>

  <span class="ss">Background</span><span class="p">:</span> <span class="no">Create</span> <span class="n">news</span> <span class="n">article</span>                           <span class="c1"># features/articles.feature:8</span>
    <span class="no">Given</span> <span class="n">I</span> <span class="n">create</span> <span class="n">a</span> <span class="n">news</span> <span class="n">article</span> <span class="n">named</span> <span class="s2">&quot;Hello World&quot;</span>       <span class="c1"># features/step_definitions/articles.rb:1</span>
    <span class="no">Then</span> <span class="n">I</span> <span class="n">should</span> <span class="n">be</span> <span class="n">able</span> <span class="n">to</span> <span class="n">find</span> <span class="n">the</span> <span class="n">article</span> <span class="s2">&quot;Hello World&quot;</span> <span class="c1"># features/step_definitions/articles.rb:14</span>

<span class="mi">0</span> <span class="n">scenarios</span>
<span class="mi">2</span> <span class="n">steps</span> <span class="p">(</span><span class="mi">2</span> <span class="n">passed</span><span class="p">)</span>
<span class="mi">0</span><span class="n">m0</span><span class="o">.</span><span class="mo">017</span><span class="n">s</span></code></pre></div>


<p>Excellent.  Now it is time to add a Scenario.  As stated previously, I want to add a scenario that displays 10 of the most recent news articles on the home page.  Lets add that scenario:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">alk3</span><span class="vi">@exitstatusone</span><span class="ss">:~</span><span class="sr">/Learn/</span><span class="no">Sinatra</span><span class="o">/</span><span class="no">Projects</span><span class="o">/</span><span class="n">tutorial</span><span class="err">$</span> <span class="n">cucumber</span>
<span class="ss">Feature</span><span class="p">:</span> <span class="no">View</span> <span class="no">Articles</span>
  <span class="no">In</span> <span class="n">order</span> <span class="n">to</span> <span class="n">view</span> <span class="n">articles</span>
  <span class="no">As</span> <span class="n">a</span> <span class="n">user</span>
  <span class="n">I</span> <span class="n">must</span> <span class="n">visit</span> <span class="n">the</span> <span class="n">home</span> <span class="n">page</span>
  <span class="no">And</span> <span class="n">click</span> <span class="n">a</span> <span class="n">link</span> <span class="n">to</span> <span class="n">view</span> <span class="n">an</span> <span class="n">aritcle</span>
  <span class="no">Then</span> <span class="n">it</span> <span class="n">will</span> <span class="n">be</span> <span class="n">displayed</span>

  <span class="ss">Background</span><span class="p">:</span> <span class="no">Create</span> <span class="n">news</span> <span class="n">article</span>                           <span class="c1"># features/articles.feature:8</span>
    <span class="no">Given</span> <span class="n">I</span> <span class="n">create</span> <span class="n">a</span> <span class="n">news</span> <span class="n">article</span> <span class="n">named</span> <span class="s2">&quot;Hello World&quot;</span>       <span class="c1"># features/step_definitions/articles.rb:1</span>
    <span class="no">Then</span> <span class="n">I</span> <span class="n">should</span> <span class="n">be</span> <span class="n">able</span> <span class="n">to</span> <span class="n">find</span> <span class="n">the</span> <span class="n">article</span> <span class="s2">&quot;Hello World&quot;</span> <span class="c1"># features/step_definitions/articles.rb:14</span>

  <span class="ss">Scenario</span><span class="p">:</span> <span class="no">Display</span> <span class="n">the</span> <span class="n">last</span> <span class="mi">10</span> <span class="n">news</span> <span class="n">articles</span> <span class="n">on</span> <span class="n">home</span> <span class="n">page</span>  <span class="c1"># features/articles.feature:12</span>
    <span class="no">Given</span> <span class="n">I</span> <span class="n">am</span> <span class="n">on</span> <span class="n">the</span> <span class="n">site</span> <span class="n">page</span> <span class="s2">&quot;/&quot;</span>                         <span class="c1"># features/articles.feature:13</span>
    <span class="no">Then</span> <span class="n">I</span> <span class="n">should</span> <span class="n">be</span> <span class="n">able</span> <span class="n">to</span> <span class="n">see</span> <span class="s2">&quot;Recent Posts&quot;</span>             <span class="c1"># features/articles.feature:14</span>
    <span class="no">And</span> <span class="n">the</span> <span class="n">first</span> <span class="n">article</span> <span class="n">named</span> <span class="s2">&quot;Hello World&quot;</span>               <span class="c1"># features/articles.feature:15</span>

<span class="mi">1</span> <span class="n">scenario</span> <span class="p">(</span><span class="mi">1</span> <span class="n">undefined</span><span class="p">)</span>
<span class="mi">5</span> <span class="n">steps</span> <span class="p">(</span><span class="mi">3</span> <span class="n">undefined</span><span class="p">,</span> <span class="mi">2</span> <span class="n">passed</span><span class="p">)</span>
<span class="mi">0</span><span class="n">m0</span><span class="o">.</span><span class="mo">015</span><span class="n">s</span>

<span class="no">You</span> <span class="n">can</span> <span class="n">implement</span> <span class="n">step</span> <span class="n">definitions</span> <span class="k">for</span> <span class="n">undefined</span> <span class="n">steps</span> <span class="n">with</span> <span class="n">these</span> <span class="ss">snippets</span><span class="p">:</span>

<span class="no">Given</span><span class="p">(</span><span class="sr">/^I am on the site page &quot;(.*?)&quot;$/</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">arg1</span><span class="o">|</span>
  <span class="n">pending</span> <span class="c1"># express the regexp above with the code you wish you had</span>
<span class="k">end</span>

<span class="no">Then</span><span class="p">(</span><span class="sr">/^I should be able to see &quot;(.*?)&quot;$/</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">arg1</span><span class="o">|</span>
  <span class="n">pending</span> <span class="c1"># express the regexp above with the code you wish you had</span>
<span class="k">end</span>

<span class="no">Then</span><span class="p">(</span><span class="sr">/^the first article named &quot;(.*?)&quot;$/</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">arg1</span><span class="o">|</span>
  <span class="n">pending</span> <span class="c1"># express the regexp above with the code you wish you had</span>
<span class="k">end</span></code></pre></div>


<p>Ok, once again, let me add the code snippets and then add in the ruby code that will check for the heading "Recent Posts" and find the article "Hello World."</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">Given</span><span class="p">(</span><span class="sr">/^I am on the site page &quot;(.*?)&quot;$/</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">arg1</span><span class="o">|</span>
  <span class="n">visit</span><span class="p">(</span><span class="n">arg1</span><span class="p">)</span>
<span class="k">end</span>

<span class="no">Then</span><span class="p">(</span><span class="sr">/^I should be able to see &quot;(.*?)&quot;$/</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">arg1</span><span class="o">|</span>
  <span class="n">page</span><span class="o">.</span><span class="n">should</span> <span class="n">have_content</span><span class="p">(</span><span class="n">arg1</span><span class="p">)</span>
<span class="k">end</span>

<span class="no">Then</span><span class="p">(</span><span class="sr">/^the first article named &quot;(.*?)&quot;$/</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">arg1</span><span class="o">|</span>
  <span class="n">page</span><span class="o">.</span><span class="n">should</span> <span class="n">have_content</span><span class="p">(</span><span class="n">arg1</span><span class="p">)</span>
<span class="k">end</span></code></pre></div>


<p>This bit of code makes use of Capybara.  visit(arg1), tells Cucumber to use Capybara to visit the Home Page, as described in the Scenario.  Then Capybara checks if the page has the words described as well.  If all goes well, the step definition should pass.  I will run Cucumber again:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">alk3</span><span class="vi">@exitstatusone</span><span class="ss">:~</span><span class="sr">/Learn/</span><span class="no">Sinatra</span><span class="o">/</span><span class="no">Projects</span><span class="o">/</span><span class="n">tutorial</span><span class="err">$</span> <span class="n">cucumber</span>
<span class="ss">Feature</span><span class="p">:</span> <span class="no">View</span> <span class="no">Articles</span>
  <span class="no">In</span> <span class="n">order</span> <span class="n">to</span> <span class="n">view</span> <span class="n">articles</span>
  <span class="no">As</span> <span class="n">a</span> <span class="n">user</span>
  <span class="n">I</span> <span class="n">must</span> <span class="n">visit</span> <span class="n">the</span> <span class="n">home</span> <span class="n">page</span>
  <span class="no">And</span> <span class="n">click</span> <span class="n">a</span> <span class="n">link</span> <span class="n">to</span> <span class="n">view</span> <span class="n">an</span> <span class="n">aritcle</span>
  <span class="no">Then</span> <span class="n">it</span> <span class="n">will</span> <span class="n">be</span> <span class="n">displayed</span>

  <span class="ss">Background</span><span class="p">:</span> <span class="no">Create</span> <span class="n">news</span> <span class="n">article</span>                           <span class="c1"># features/articles.feature:8</span>
    <span class="no">Given</span> <span class="n">I</span> <span class="n">create</span> <span class="n">a</span> <span class="n">news</span> <span class="n">article</span> <span class="n">named</span> <span class="s2">&quot;Hello World&quot;</span>       <span class="c1"># features/step_definitions/articles.rb:1</span>
    <span class="no">Then</span> <span class="n">I</span> <span class="n">should</span> <span class="n">be</span> <span class="n">able</span> <span class="n">to</span> <span class="n">find</span> <span class="n">the</span> <span class="n">article</span> <span class="s2">&quot;Hello World&quot;</span> <span class="c1"># features/step_definitions/articles.rb:14</span>

  <span class="ss">Scenario</span><span class="p">:</span> <span class="no">Display</span> <span class="n">the</span> <span class="n">last</span> <span class="mi">10</span> <span class="n">news</span> <span class="n">articles</span> <span class="n">on</span> <span class="n">home</span> <span class="n">page</span>  <span class="c1"># features/articles.feature:12</span>
    <span class="no">Given</span> <span class="n">I</span> <span class="n">am</span> <span class="n">on</span> <span class="n">the</span> <span class="n">site</span> <span class="n">page</span> <span class="s2">&quot;/&quot;</span>                         <span class="c1"># features/step_definitions/articles.rb:19</span>
    <span class="no">Then</span> <span class="n">I</span> <span class="n">should</span> <span class="n">be</span> <span class="n">able</span> <span class="n">to</span> <span class="n">see</span> <span class="s2">&quot;Recent Posts&quot;</span>             <span class="c1"># features/step_definitions/articles.rb:23</span>
    <span class="no">And</span> <span class="n">the</span> <span class="n">first</span> <span class="n">article</span> <span class="n">named</span> <span class="s2">&quot;Hello World&quot;</span>               <span class="c1"># features/step_definitions/articles.rb:27</span>

<span class="mi">1</span> <span class="n">scenario</span> <span class="p">(</span><span class="mi">1</span> <span class="n">passed</span><span class="p">)</span>
<span class="mi">5</span> <span class="n">steps</span> <span class="p">(</span><span class="mi">5</span> <span class="n">passed</span><span class="p">)</span>
<span class="mi">0</span><span class="n">m0</span><span class="o">.</span><span class="mi">143</span><span class="n">s</span></code></pre></div>


<hr />

<p>At this point you should get the basic idea of how to utilize Cucumber and Capybara to develop Sinatra based Web Applications.  The process to develop Ruby on Rails applications is nearly the same, minus a few things here and there.  Hopefully, this article was not too confusing and it is easy to follow- it is quite detailed for such a basic application.  I also hope that you find the value in using Cucumber and Capybara to develop web applications.</p>

						</span>
					</article>
				</div>
				<div class="col-sm-4">
				<div class="list-group">
	<h4 class="list-group-item">Related Posts</h4>
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
				
			
		
	
		
			
				
					<a class="list-group-item" href="/sinatra-simple-blog/" title="Basic Sinatra Blog">Basic Sinatra Blog</a>
				
			
		
	
		
			
		
	
		
			
		
	
		
			
				
					<a class="list-group-item" href="/introducing-sinatra-web-application-framework/" title="Introducing: Sinatra Web Application Framework">Introducing: Sinatra Web Application Framework</a>
				
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
</div>


				</div>
			</div>
			<br /><br />
<p><strong>If you feel the information here is outdated or incorrect, you can submit a <a href="https://github.com/BrentonEarl/brentonearl.github.io/edit/source/_posts/2013-08-04-cucumber-capybara-with-sinatra.markdown">Pull Request on Github!</a></strong></p>

			
<div class="row">
	<div class="col-sm-8">
		<div id="disqus_thread" style="padding:1%;"></div>
		<script type="text/javascript">
		var disqus_shortname = 'exitstatusone';
		(function() {
		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
		})();
		</script>
		<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
		<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
	</div>
</div>



		</div>
	
		<footer>
			<div class="container">
				<div class="row">
					<div class="col-sm-8">
						<p class="footer">
						&copy; 2012-2015 Brenton Earl. Powered by <a href="http://jekyllrb.com/" title="Jekyllrb">Jekyll</a>.
						</p>
					</div>
				</div>
			</div>
		</footer>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
		<script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
	</body>
</html>
